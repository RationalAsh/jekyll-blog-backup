---
layout: post
title: My First Build of BB-8
date: '2016-02-27T01:54:00.000+05:30'
author: Ashwin Narayan
comments: true
tags:
- cool stuff
- robotics
- star wars
- technical
modified_time: '2016-02-27T01:54:47.381+05:30'
thumbnail: https://3.bp.blogspot.com/-TIaokW7Nk20/VqCChsZS-DI/AAAAAAAAHsI/YrXyDhkFNbo/s72-c/dpend_sim2.gif
blogger_id: tag:blogger.com,1999:blog-259194268438499485.post-6517655310906261828
blogger_orig_url: http://ashwinnarayan.blogspot.com/2016/02/my-first-build-of-bb-8.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: justify;">Being a robotics person, the part of Star Wars: The Force Awakens that gave me the most delight was BB-8! The cute little droid who rolls along on a sphere. The moment I saw it on screen I knew that I had to build it! This blogpost documents my entire build process.<br /><br />I decided that the first thing I should do is come up with a good control mechanism. The first thing I thought of was a pendulum hanging from a diametric bar inside the sphere. The pendulum would be free hanging and an actuator would apply torque on it and make the sphere roll. This seemed a simple enough system to work with. So I started the process of simulating the robot and coming up with a good control system.<br /><br /><h3>The Mathy Stuff</h3>The easiest way to model a sort of complex system like this is to use Lagrangian mechanics. Write down the difference between the kinetic and potential energies of the system, apply the Euler-Lagrange equations to get the equations of motion and plug the equations into a differential equation with initial conditions. This general procedure can be used to simulate a wide range of mechanical systems. It's an essential part of any roboticist's toolkit.<br /><br />In the case of the BB-8 sphere pendulum system the equations of motion come out as:<br /><br />$\frac{5}{3} m_b \ddot{x}(t)+m_p \left(l \ddot{\theta}(t) \cos (\theta (t))-l \dot{\theta}(t)^2 \sin (\theta (t))+\ddot{x}(t)\right)=\frac{u(t)}{r}$<br />$l m_p \left(g \sin (\theta (t))+l \ddot{\theta}(t)+\cos (\theta (t)) \ddot{x}(t)\right)=-u(t)$<br /><br />Here $m_b$ is the mass of the ball, $m_p$ is the mass of the pendulum, $l$ the length of the pendulum rod and $r$ the radius of the sphere. The state of the robot is represented by the state vector $\left[ \begin{array}{c} x \\ \theta \\ \dot{x} \\ \dot{\theta} \end{array} \right]$ where $x$ is the distance the sphere has rolled and $\theta$ is the angle the pendulum makes with the vertical.<br /><br />When the motor applies a torque on the pendulum, it also applies an equal and opposite torque on the shaft on the spherical body. This is the control torque we're going to use to make BB-8 roll back and forth. For the mass of the pendulum I am using another motor with a weighted disk. This motor can react against the weighted disk to make the robot turn left and right. These two mechanisms are enough to make BB-8 go anywhere! Since this robot is an open chain manipulator, the equations of motion can be written in the manipulator equation form $H(q)\ddot{q}&nbsp;+ C(q,\dot{q})\dot{q}&nbsp;+ G(q) = Bu$.<br /><br />$\left[\begin{array}{cc}\frac{5}{3}m_b + m_p &amp; m_pl\cos\theta \\ m_pl\cos\theta &amp; m_pl^2\end{array}\right] \left[\begin{array}{c}\ddot{x} \\ \ddot{\theta}\end{array}\right] + \left[\begin{array}{cc}0 &amp; -m_pl\dot{\theta}\sin\theta \\ 0 &amp; 0&nbsp;\end{array}\right] \left[\begin{array}{c}\dot{x} \\ \dot{\theta}\end{array}\right] +&nbsp;\left[\begin{array}{c}0 \\ m_pgl\sin\theta\end{array}\right] =&nbsp;\left[\begin{array}{c}&nbsp;\frac{1}{r} \\ -1&nbsp;\end{array}\right] u $<br /><br />This is what the system looks like without any motors.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/fzPA2yp.gif" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/fzPA2yp.gif" height="160" width="640" /></a></div><br /><br />We can easily write the manipulator equation to the standard form ( $\dot{x} = f(x,u)$ ), linearize it around any equilibrium point to get a linear state space model and implement a linear controller. I'm so glad that I had Mathematica to help me with the modeling. It made things very simple and I could get a simple LQR for controlling the sphere working without too much hassle. Here's what the motion of the sphere looks like with the controller.&nbsp;</div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-TIaokW7Nk20/VqCChsZS-DI/AAAAAAAAHsI/YrXyDhkFNbo/s1600/dpend_sim2.gif" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="160" src="https://3.bp.blogspot.com/-TIaokW7Nk20/VqCChsZS-DI/AAAAAAAAHsI/YrXyDhkFNbo/s640/dpend_sim2.gif" width="640" /></a></div><div style="text-align: justify;"><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-_G1jSQmsRME/VtCv7hEzCJI/AAAAAAAAIAc/Kv5Sd-uDgOg/s1600/bb8_lqr_graph.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="186" src="https://4.bp.blogspot.com/-_G1jSQmsRME/VtCv7hEzCJI/AAAAAAAAIAc/Kv5Sd-uDgOg/s320/bb8_lqr_graph.jpeg" width="320" /></a></div><br /><h3>The Body</h3>Now it's time to build! First I was stuck on what to make the sphere out of. I didn't want the robot to be too small and at first, I couldn't think of any place to find a sphere. So i started designing a spherical shell in Blender. I had to do it in parts because of size constraints on the 3D printer. This was very time consuming. And then it struck me! I could use on of these! :D<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-V-g3BxRy0fk/VrNCn2IG4lI/AAAAAAAAH4Y/gdUvdzhNaqU/s1600/globe.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="https://1.bp.blogspot.com/-V-g3BxRy0fk/VrNCn2IG4lI/AAAAAAAAH4Y/gdUvdzhNaqU/s200/globe.jpg" width="200" /></a></div><insert globe="" of="" photo=""></insert><br /><br />I bought a 20 cm diameter globe off amazon. The sphere is made out of ABS plastic which is really nice. I used a hacksaw to cut the sphere in half. The next challenge is to mount the motors. I tried reusing empty potato chip cans but most of them didn't have the dimensions that I wanted. So in the end I decided to 3D print a motor housing and some parts to couple the sphere to the motors. I used Blender (Open Source! Yay! :D) to design the parts.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-oGep7_zoMjg/VrNDtC4ncOI/AAAAAAAAH4g/-cYZI97JOaQ/s1600/Model2.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="360" src="https://4.bp.blogspot.com/-oGep7_zoMjg/VrNDtC4ncOI/AAAAAAAAH4g/-cYZI97JOaQ/s640/Model2.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Initial Render of what the internals were going to look like.</td></tr></tbody></table>However, it turned out that 3D printing parts is a bit time consuming. Also, the motor couplings were difficult to print without using a lot of support material. After a few iterations of redesigning and checking, the final motor coupling was printed. I made a decent looking motor housing out of some wood and metal L-shaped motor mounts.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-crMs9A5vpFQ/VslKOuFgUAI/AAAAAAAAH7I/FcSVql4V0y0/s1600/P_20160220_235153.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="360" src="https://4.bp.blogspot.com/-crMs9A5vpFQ/VslKOuFgUAI/AAAAAAAAH7I/FcSVql4V0y0/s640/P_20160220_235153.jpg" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The motor assembly</td></tr></tbody></table><h3>The Electronics</h3><div>An Arduino Nano with an Atmega328 is the brain of the robot. A GY521 accelerometer/gyro board helps me measure the angle of the motor assembly with respect to the ground and a rotary encoder coupled to the dead axle helps me measure the speed and position of the ball. A HC05 Bluetooth module communicates with an Android app that I made using MIT App Inventor so that I can control the robot.&nbsp;</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-kXoJlI2km1E/VsyS9GCf1vI/AAAAAAAAH9I/PYHUqcDsvQQ/s1600/P_20160221_161359.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://2.bp.blogspot.com/-kXoJlI2km1E/VsyS9GCf1vI/AAAAAAAAH9I/PYHUqcDsvQQ/s640/P_20160221_161359.jpg" width="360" /></a></div><div><br /></div><div>Putting it all together lead to this huge mess of wires.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-poJHGBdxk3I/VtCsJbK0D8I/AAAAAAAAH_8/5p1VB20ECa4/s1600/P_20160226_102536.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="360" src="https://2.bp.blogspot.com/-poJHGBdxk3I/VtCsJbK0D8I/AAAAAAAAH_8/5p1VB20ECa4/s640/P_20160226_102536.jpg" width="640" /></a></div><br />After multiple attempts at rewiring, I got to this slightly less messy (but still quite messy) state.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-UOXXHtVQOQo/VtCsjaXYhXI/AAAAAAAAIAE/ZpIzdLIyaRU/s1600/P_20160227_011727.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="360" src="https://4.bp.blogspot.com/-UOXXHtVQOQo/VtCsjaXYhXI/AAAAAAAAIAE/ZpIzdLIyaRU/s640/P_20160227_011727.jpg" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The battery is also included in this one.</td></tr></tbody></table>Despite the messiness, it actually works! :D I made it roll around for a bit.<br /><br />Since this was my first build, I decided that it should more of a proof of concept than a robust build. So I built it very fast. Now &nbsp;that I know that it works, I can spend some time designing a nice PCB to make the wiring neater and more compact. I also need to fine tune the control loop so that the whole thing moves smoothly. No point in tuning it on this since I'll be rebuilding a part of it anyway.<br /><br />Watch out for the next post about a more robust build!<br /><br /></div></div></div>
